<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<!--<link rel="stylesheet" href="{{ url_for('static', filename='/css/index.css') }}">-->

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/index_.css') }}">
<style>
.table-striped>tbody>tr:nth-of-type(odd){
	background-color: rgb(125, 125, 125);
}
</style>
<header>
  <div style="height: 200px; background-color: black">
    <h1 style="margin: auto auto; color: White; padding-top:50px; padding-left:30px">
        <form action="/user/{{name_user}}" method="get">
<!--            <input id="name_user" style="display:none" value={{name_user}} >-->
            <input type="submit" value="BACK TO HOME" style="border: 3px solid lightgray; border-radius: 20px; color: white; background-color: gray; padding:12px;">
        </form>
    </h1>

</div>
    <div class="lightbox">
        <div></div>
        <img id="loadinggif" style="position: fixed; left: 49%; top: 45vh; z-index: 120; width:2.5%; display:none" src="{{ url_for('static', filename='/loading_gif/loading_nob.gif') }}" alt="Loading"/>
    </div>
</header>
<body style="background-color: rgb(125, 125, 125);">

<img class="cangiua" id="myImage" width={{ size_w }} height={{ size_h }} src="{{ url_for('static', filename='/users/') }}/{{name_user}}/{{dir_video}}/raw_img.jpg" style="position: relative; width:{{ size_w }}; height:{{ size_h }}; border:1px solid green;top: 100px;left: 0px;z-index:-1;">
  <!-- <source src="mov_bbb.ogg" type="video/ogg">
  Your browser does not support HTML5 video. -->
</img>


<div style="margin: auto 0">

        <div style='position: absolute; margin:0px; width:{{ size_w }}; height:{{ size_h }}; border:1px solid black;top: 300px'>
          <canvas id="myCanvas" width={{ size_w }} height={{ size_h }} style="cursor:crosshair"></canvas>
        </div>

    </div>
<button onclick="on_click_clear()" type="button" class="btn_clear_line" >Clear Lines</button><br>
<!--<form action="/toado_hour/{{name_user}}/{{file_path}}" method="get" id="form_predict">-->
<form action="/{{name_user}}/{{dir_video}}/speed_bottom_v2/{{num_class}}" method="post" id="form_predict">

    <input id = "name_vi" class="name_video_draw background_cl" name="name_vi" readonly value = {{ file_path }}>
    <input id="logX" class="an_obj" name="x" value="x_0">
    <input id="logY" class="an_obj" name="y" value="y_0">
    <input id="logX1" class="an_obj" name="x1" value="x_1">
    <input id="logY1" class="an_obj" name="y1" value="y_1">
    <input id="logX2" class="an_obj" name="x2" value="x_2">
    <input id="logY2" class="an_obj" name="y2" value="y_2">
    <input id="logX3" class="an_obj" name="x3" value="x_3">
    <input id="logY3" class="an_obj" name="y3" value="y_3">
    <input id="logA_1_1" class="an_obj" name="A_1_1" value="x_4">
    <input id="logB_1_1" class="an_obj" name="B_1_1" value="y_4">
    <input id="logA_1_2" class="an_obj" name="A_1_2" value="x_5">
    <input id="logB_1_2" class="an_obj" name="B_1_2" value="y_5">
    <input id="logA_2_1" class="an_obj" name="A_2_1" value="x_6">
    <input id="logB_2_1" class="an_obj" name="B_2_1" value="y_6">
    <input id="logA_2_2" class="an_obj" name="A_2_2" value="x_7">
    <input id="logB_2_2" class="an_obj" name="B_2_2" value="y_7">
    <input id="logA_3_1" class="an_obj" name="A_3_1" value="x_8">
    <input id="logB_3_1" class="an_obj" name="B_3_1" value="y_8">
    <input id="logA_3_2" class="an_obj" name="A_3_2" value="x_9">
    <input id="logB_3_2" class="an_obj" name="B_3_2" value="y_9">
    <input id="logA_4_1" class="an_obj" name="A_4_1" value="x_10">
    <input id="logB_4_1" class="an_obj" name="B_4_1" value="y_10">
    <input id="logA_4_2" class="an_obj" name="A_4_2" value="x_11">
    <input id="logB_4_2" class="an_obj" name="B_4_2" value="y_11">
<!--    <input id="logA_5_1" class="an_obj" name="A_5_1" value="x_12">-->
<!--    <input id="logB_5_1" class="an_obj" name="B_5_1" value="y_12">-->
<!--    <input id="logA_5_2" class="an_obj" name="A_5_2" value="x_13">-->
<!--    <input id="logB_5_2" class="an_obj" name="B_5_2" value="y_13">-->
<!--    <input id="logA_6_1" class="an_obj" name="A_6_1" value="x_14">-->
<!--    <input id="logB_6_1" class="an_obj" name="B_6_1" value="y_14">-->
<!--    <input id="logA_6_2" class="an_obj" name="A_6_2" value="x_15">-->
<!--    <input id="logB_6_2" class="an_obj" name="B_6_2" value="y_15">-->
    <br><br><br><br><br>
    <div class="time_sub" style="position:relative; top:120px;left:30px; font-size:15px">
        <label for="str_start_time">Time start of video:</label>
        <input type="datetime-local" id="str_start_time" name="str_start_time" step="1" value={{ str_start_time }}>
            <br>
            <label for="str_end_time">Time end of video  :</label>
        <input type="datetime-local" id="str_end_time" name="str_end_time" step="1" value={{ str_end_time }}>
    </div>

    <div style="margin-top:200px">
        <label for="idD1">D1:</label>
	    <input id="idD1" name="D1" required value= {{ D1 }} >
        <label for="idD2">D2:</label>
	    <input id="idD2" name="D2" required value= {{ D2 }} >
        <label for="idD3">D3:</label>
	    <input id="idD3" name="D3" required value= {{ D3 }} >
        <label for="idD4">D4:</label>
	    <input id="idD4" name="D4" required value= {{ D4 }} >
<!--        <label for="idD5">D5:</label>-->
<!--	    <input id="idD5" name="D5" required value= {{ D5 }} >-->
<!--        <label for="idD6">D6:</label>-->
<!--	    <input id="idD6" name="D6" required value= {{ D6 }} >-->
    </div>
    <br><br><br><br><br><br>

    <input type="submit" class="btn_predict" onclick="" value="Submit" >

</form>
<script>
    $( "#form_predict" ).submit(function( event ) {
    var time1 = document.getElementById("time1").value;
  var time2 = document.getElementById("time2").value;
  var start = document.getElementById("start").value;
  var end = document.getElementById("end").value;
  var numM = document.getElementById("numM").value;
  if ( $( "#logX" ).first().val() === "x_0" || $( "#logX1" ).first().val() === 'x_1' ||
    $( "#logY" ).first().val() === 'y_0' || $( "#logY1" ).first().val() === 'y_1' ||
    $( "#logX2" ).first().val() === 'x_2' || $( "#logX3" ).first().val() === 'x_3' ||
    $( "#logY2" ).first().val() === 'y_2' || $( "#logY3" ).first().val() === 'y_3'||
    $( "#logA_1_1" ).first().val() === 'x_4' || $( "#logA_1_2" ).first().val() === 'x_5' ||
    $( "#logB_1_1" ).first().val() === 'y_4' || $( "#logB_1_2" ).first().val() === 'y_5' ||
    $( "#logA_2_1" ).first().val() === 'x_6' || $( "#logA_2_2" ).first().val() === 'x_7' ||
    $( "#logB_2_1" ).first().val() === 'y_6' || $( "#logB_2_2" ).first().val() === 'y_7' ||
    $( "#logA_3_1" ).first().val() === "x_8" || $( "#logA_3_2" ).first().val() === 'x_9' ||
    $( "#logB_3_1" ).first().val() === 'y_8' || $( "#logB_3_2" ).first().val() === 'y_9' ) {
    alert("Bạn kẻ thiếu Line/chưa xác định hướng A to B.\nVui lòng vẽ đủ 4 line. và xác định hướng.");
    return false;
  } else {
    load_gif();
    return true;
  }
});
</script>
<script>
    function load_gif (){
        var lightbox=document.querySelectorAll(".lightbox")[0];
        lightbox.style.display = 'none';
    }
</script>
<script>
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");
    ctx.font = "30px Comic Sans MS";
    ctx.fillStyle = "red";
    ctx.moveTo({{x0}},{{y0}});
    ctx.lineTo({{x1}},{{y1}});
    ctx.lineWidth = 4;
    ctx.moveTo({{x2}},{{y2}});
    ctx.lineTo({{x3}},{{y3}});
    ctx.lineWidth = 4;
    ctx.moveTo({{A_1_1}},{{B_1_1}});
    ctx.lineTo({{A_1_2}},{{B_1_2}});
    ctx.lineWidth = 4;
    ctx.moveTo({{A_2_1}},{{B_2_1}});
    ctx.lineTo({{A_2_2}},{{B_2_2}});
    ctx.lineWidth = 4;
    ctx.moveTo({{A_3_1}},{{B_3_1}});
    ctx.lineTo({{A_3_2}},{{B_3_2}});
    ctx.lineWidth = 4;
    ctx.moveTo({{A_4_1}},{{B_4_1}});
    ctx.lineTo({{A_4_2}},{{B_4_2}});
    ctx.lineWidth = 4;
<!--    ctx.moveTo({{A_5_1}},{{B_5_1}});-->
<!--    ctx.lineTo({{A_5_2}},{{B_5_2}});-->
<!--    ctx.lineWidth = 4;-->
<!--    ctx.moveTo({{A_6_1}},{{B_6_1}});-->
<!--    ctx.lineTo({{A_6_2}},{{B_6_2}});-->
<!--    ctx.lineWidth = 4;-->
    ctx.strokeStyle = 'blue';
    ctx.stroke();
    ctx.fillText("Line0", {{x1}}, {{y1}});
    ctx.fillText("Line1", {{x3}}, {{y3}});
    ctx.fillText("D1", {{A_1_1}}, {{B_1_1}});
    ctx.fillText("D2", {{A_2_1}}, {{B_2_1}});
    ctx.fillText("D3", {{A_3_1}}, {{B_3_1}});
    ctx.fillText("D4", {{A_4_1}}, {{B_4_1}});
<!--    ctx.fillText("D5", {{A_5_1}}, {{B_5_1}});-->
<!--    ctx.fillText("D6", {{A_6_1}}, {{B_6_1}});-->
</script>

    <script type="text/javascript">
        var canvas = document.getElementById('myCanvas');
        canvas.addEventListener('click', on_canvas_click, false);
        let i=1;

        var context=canvas.getContext('2d');

        context.fillStyle='red';
        context.fillRect(0,0,10,1);
        context.fillRect(0,0,1,10);

        function getNumericStyleProperty(style, prop) {
          return parseInt(style.getPropertyValue(prop),10);
        }

        function on_canvas_click(ev) {
          var boundingRect = ev.target.getBoundingClientRect();
          var x = ev.clientX - boundingRect.left,
              y = ev.clientY - boundingRect.top;

              if (i==1) {
                x0=x;
                y0=y;
                document.getElementById("logX").value = x
                document.getElementById("logY").value = y
                i=i+1;
              } else if (i==2) {
                x1=x;
                y1=y;
                document.getElementById("logX1").value = x
                document.getElementById("logY1").value = y
                i=i+1;
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");
                ctx.moveTo(x0,y0);
                ctx.lineTo(x1,y1);
                ctx.lineWidth = 4;


          // set line color
                ctx.strokeStyle = 'blue';
                ctx.stroke();
                ctx.font = "30px Comic Sans MS";
                ctx.fillStyle = "red";
                ctx.fillText("Line0", x1, y1);

              } else if (i==3) {
                x2=x;
                y2=y;
                document.getElementById("logX2").value = x
                document.getElementById("logY2").value = y
                i=i+1;
              } else if (i==4) {
                x3=x;
                y3=y;
                document.getElementById("logX3").value = x
                document.getElementById("logY3").value = y
                i=i+1;
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");
                ctx.moveTo(x2,y2);
                ctx.lineTo(x3,y3);
                ctx.lineWidth = 4;


          // set line color
                ctx.strokeStyle = 'blue';
                ctx.stroke();
                ctx.font = "30px Comic Sans MS";
                ctx.fillStyle = "red";
                ctx.fillText("Line1", x3, y3);

              } else if (i==5) {
                A_1_1=x;
                B_1_1=y;
                document.getElementById("logA_1_1").value = x
                document.getElementById("logB_1_1").value = y
                i=i+1;
              } else if (i==6) {
                A_1_2=x;
                B_1_2=y;
                document.getElementById("logA_1_2").value = x
                document.getElementById("logB_1_2").value = y
                i=i+1;
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");
                ctx.moveTo(A_1_1,B_1_1);
                ctx.lineTo(A_1_2,B_1_2);
                ctx.lineWidth = 4;


          // set line color
                ctx.strokeStyle = 'blue';
                ctx.stroke();
                ctx.font = "30px Comic Sans MS";
                ctx.fillStyle = "red";
                ctx.fillText("D1", A_1_2, B_1_2);

              } else if (i==7) {
                A_2_1=x;
                B_2_1=y;
                document.getElementById("logA_2_1").value = x
                document.getElementById("logB_2_1").value = y
                i=i+1;
              } else if (i==8) {
                A_2_2=x;
                B_2_2=y;
                document.getElementById("logA_2_2").value = x
                document.getElementById("logB_2_2").value = y
                i=i+1;
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");
                ctx.moveTo(A_2_1,B_2_1);
                ctx.lineTo(A_2_2,B_2_2);
                ctx.lineWidth = 4;


          // set line color
                ctx.strokeStyle = 'blue';
                ctx.stroke();
                ctx.font = "30px Comic Sans MS";
                ctx.fillStyle = "red";
                ctx.fillText("D2", A_2_2, B_2_2);

              } else if (i==9) {
                A_3_1=x;
                B_3_1=y;
                document.getElementById("logA_3_1").value = x
                document.getElementById("logB_3_1").value = y
                i=i+1;
              } else if (i==10) {
                A_3_2=x;
                B_3_2=y;
                document.getElementById("logA_3_2").value = x
                document.getElementById("logB_3_2").value = y
                i=i+1;
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");
                ctx.moveTo(A_3_1,B_3_1);
                ctx.lineTo(A_3_2,B_3_2);
                ctx.lineWidth = 4;


          // set line color
                ctx.strokeStyle = 'blue';
                ctx.stroke();
                ctx.font = "30px Comic Sans MS";
                ctx.fillStyle = "red";
                ctx.fillText("D3", A_3_1, B_3_1);


              } else if (i==11) {
                A_4_1=x;
                B_4_1=y;
                document.getElementById("logA_4_1").value = x
                document.getElementById("logB_4_1").value = y
                i=i+1;
              } else if (i==12) {
                A_4_2=x;
                B_4_2=y;
                document.getElementById("logA_4_2").value = x
                document.getElementById("logB_4_2").value = y
                i=i+1;
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");
                ctx.moveTo(A_4_1,B_4_1);
                ctx.lineTo(A_4_2,B_4_2);
                ctx.lineWidth = 4;


          // set line color
                ctx.strokeStyle = 'blue';
                ctx.stroke();
                ctx.font = "30px Comic Sans MS";
                ctx.fillStyle = "red";
                ctx.fillText("D4", A_4_1, B_4_1);


<!--              } else if (i==13) {-->
<!--                A_5_1=x;-->
<!--                B_5_1=y;-->
<!--                document.getElementById("logA_5_1").value = x-->
<!--                document.getElementById("logB_5_1").value = y-->
<!--                i=i+1;-->
<!--              } else if (i==14) {-->
<!--                A_5_2=x;-->
<!--                B_5_2=y;-->
<!--                document.getElementById("logA_5_2").value = x-->
<!--                document.getElementById("logB_5_2").value = y-->
<!--                i=i+1;-->
<!--                var canvas = document.getElementById("myCanvas");-->
<!--                var ctx = canvas.getContext("2d");-->
<!--                ctx.moveTo(A_5_1,B_5_1);-->
<!--                ctx.lineTo(A_5_2,B_5_2);-->
<!--                ctx.lineWidth = 4;-->


<!--          // set line color-->
<!--                ctx.strokeStyle = 'blue';-->
<!--                ctx.stroke();-->
<!--                ctx.font = "30px Comic Sans MS";-->
<!--                ctx.fillStyle = "red";-->
<!--                ctx.fillText("D5", A_5_1, B_5_1);-->


<!--              } else if (i==15) {-->
<!--                A_6_1=x;-->
<!--                B_6_1=y;-->
<!--                document.getElementById("logA_6_1").value = x-->
<!--                document.getElementById("logB_6_1").value = y-->
<!--                i=i+1;-->
<!--              } else if (i==16) {-->
<!--                A_6_2=x;-->
<!--                B_6_2=y;-->
<!--                document.getElementById("logA_6_2").value = x-->
<!--                document.getElementById("logB_6_2").value = y-->
<!--                i=i+1;-->
<!--                var canvas = document.getElementById("myCanvas");-->
<!--                var ctx = canvas.getContext("2d");-->
<!--                ctx.moveTo(A_6_1,B_6_1);-->
<!--                ctx.lineTo(A_6_2,B_6_2);-->
<!--                ctx.lineWidth = 4;-->


<!--          // set line color-->
<!--                ctx.strokeStyle = 'blue';-->
<!--                ctx.stroke();-->
<!--                ctx.font = "30px Comic Sans MS";-->
<!--                ctx.fillStyle = "red";-->
<!--                ctx.fillText("D6", A_6_1, B_6_1);-->


              } else {
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath();
                ctx.restore();
                i=1;
                x0=x1=x2=x3=A_1_1=A_1_2=A_2_1=A_2_2=A_3_1=A_3_2=A_4_1=A_4_2=A_5_1=A_5_2=A_6_1=A_6_2=0;y0=y1=y2=y3=B_1_1=B_1_2=B_2_1=B_2_2=B_3_1=B_3_2=B_4_1=B_4_2=B_5_1=B_5_2=B_6_1=B_6_2=0;
              }
        }
        function on_click_clear(){
            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.restore();
            i=1;
            x0=x1=x2=x3=A_1_1=A_1_2=A_2_1=A_2_2=A_3_1=A_3_2=A_4_1=A_4_2=A_5_1=A_5_2=A_6_1=A_6_2=0;y0=y1=y2=y3=B_1_1=B_1_2=B_2_1=B_2_2=B_3_1=B_3_2=B_4_1=B_4_2=B_5_1=B_5_2=B_6_1=B_6_2=0;
        }
    </script>
<div class="icon_veco">
    <div style="display: flex; position: absolute; left: 40vw">
      <img style="width: 4vw; position: relative; top: -10px" src="{{ url_for('static', filename='/image_upload/car.png') }}">
      <h3 style="color: white; font-weight: bold; position: relative; top:-60px; left: -2.8vw">Car</h3>
    </div>
    <div style="display: flex; position: absolute; left: 45vw">
      <img style="width: 4vw; position: relative; top: -10px" src="{{ url_for('static', filename='/image_upload/moto.png') }}">
      <h3 style="color: white; font-weight: bold; position: relative; top:-60px; left: -3.2vw">Motor</h3>
    </div>
    <div style="display: flex; position: absolute; left: 50vw">
      <img style="width: 4vw; position: relative; top: -10px" src="{{ url_for('static', filename='/image_upload/lgv.png') }}">
      <h3 style="color: white; font-weight: bold; position: relative; top:-60px; left: -3vw">LGV</h3>
    </div>
    <div style="display: flex; position: absolute; left: 55vw">
      <img style="width: 4vw; position: relative; top: -10px" src="{{ url_for('static', filename='/image_upload/hgv.png') }}">
      <h3 style="color: white; font-weight: bold; position: relative; top:-60px; left: -3vw">HGV</h3>
    </div>
    <div style="display: flex; position: absolute; left: 60vw">
      <img style="width: 4vw; position: relative; top: -10px" src="{{ url_for('static', filename='/image_upload/bus.png') }}">
      <h3 style="color: white; font-weight: bold; position: relative; top:-60px; left: -3vw">Bus</h3>
    </div>
  </div>
  <br><br><br><br><br>
<br><br><br><br><br>
<div class="container table_re" style="background-color: rgb(75, 75, 75);">
  <h2>SUMMARY TABLE VECO 2LINES SPEED</h2>
    {% if speed_class_infor %}
        <table class="table table-striped table-sm" >
          <tr>
            <th></th>
            <th>Số lượng xe</th>
            <th>Tốc độ trung bình</th>
            <th>Tốc độ MAX</th>
            <th>Tốc độ min</th>
          </tr>

          {% for key in speed_class_infor %}
          <tr>
            <td>{{ list_vehicle[key|int] }}</td>
            <td>{{ speed_class_infor[key]['amount'] }}</td>
            <td>{{ speed_class_infor[key]['medium'] }}</td>
            <td>{{ speed_class_infor[key]['max'] }}</td>
            <td>{{ speed_class_infor[key]['min'] }}</td>
          </tr>
          {% endfor %}
        </table>

        <h2>SỐ LƯỢNG TỐC ĐỘ THEO MỨC</h2>
        <table class="table table-striped table-sm" >
          <tr>
            <th></th>
            <th> < 40 </th>
            <th>40 ~ 60</th>
            <th>60 ~ 80</th>
            <th>80 ~ 120</th>
            <th> >120 < </th>
          </tr>

        {% for i in range (num_class) %}
          <tr>
            <td>{{ list_vehicle[i] }}</td>
            {% for key in speed_each_values %}
                <td>{{ speed_each_values[key][i|string()] }}</td>
            {% endfor %}
          </tr>
        {% endfor %}
        </table>
    {% endif %}
</div>

<br><br><br><br><br>
</body>
<!--<form action="/{{name_user}}/{{dir_video}}/download-excel" method="get" class="btn_down_csv">-->
<!--    <br><p style="color:white">Download xlsx: </p>-->
<!--    <input type="submit" class="btn_down" value="Download file .xlsx" ><br><br><br>-->
<!--</form>-->

<form action="/{{name_user}}/{{dir_video}}/download-speed" method="get" class="btn_down_csv">
    <input id = "name_vi_csv" style="display:none" name="name_vi_csv" value = {{ file_path }} readonly>
    <input type="submit" class="btn_down" value="Download file excel" ><br><br><br>
</form>
<form action="/{{name_user}}/{{dir_video}}/processing-video" method="post" class="btn_down_csv">
    <input id="logXd" class="an_obj" name="x" value={{ x0 }}>
    <input id="logYd" class="an_obj" name="y" value={{ y0 }}>
    <input id="logX1d" class="an_obj" name="x1" value={{ x1 }}>
    <input id="logY1d" class="an_obj" name="y1" value={{ y1 }}>
    <input id="logX2d" class="an_obj" name="x2" value={{ x2 }}>
    <input id="logY2d" class="an_obj" name="y2" value={{ y2 }}>
    <input id="logX3d" class="an_obj" name="x3" value= {{ x3 }}>
    <input id="logY3d" class="an_obj" name="y3" value={{ y3 }}>
    <input id = "name_video" style="display:none" name="name_video" value = {{ file_path }} readonly>
    <input class="an_obj" name="task" value="speed">
    <input type="submit" class="btn_down" value="Download file video" ><br><br><br>
</form>
